<html>
	<head>
		<style>
			#editor { display: none; }
			#roomList { display: none; }
		</style>
		<script src="http://code.jquery.com/jquery-2.1.0.min.js" type="text/javascript"></script>
		<script src="js/editor/app.js" type="text/javascript"></script>
		<script src="js/libs/FileSaver.js" type="text/javascript"></script>
		<script>

			$( document ).ready(function() {
				function parseRooms(data) {
					data = decodeURIComponent(data);
					$('#selector').hide();
					$('#roomList').show();

					var rooms = JSON.parse(data).rooms;
					console.log('r: ', rooms);
					for (var i = rooms.length - 1; i >= 0; i--) {
						console.log('room: ' , rooms[i].name);
						$('#roomList div').append($('<li />').attr('id',i).text(rooms[i].name))
					};
					$( "#results" ).text( data );
				}
				//Load existing
				$('#files').on('change', function(evt) {
					console.log('selected');
					var files = evt.target.files;
					var contents;
					for (var i = 0, f; f = files[i]; i++) {
						var reader = new FileReader();
						reader.onload = function(e) {
							contents = e.target.result;
						}
						reader.onloadend = function() {
							parseRooms(contents);	
						}
						reader.readAsText(f);
					}

				})
			    console.log( "ready!" );
			    $('#roomMaker').on('submit', function(e) {
			    	e.preventDefault();
			    	// e.stopPropagation();
			    	// console.log('e: ', e);
			    	var str = $( this ).serialize();
			    	var t = queryToObj(str);
			    	t.id = t.name.replace(/\W/g,'_');
			    	t.name = t.name.replace(/\+/g,' ')
			    	var rooms =  { "rooms" : [t] };

			    	var o = JSON.stringify(rooms);
			    	var b = new Blob([o],{type : 'text/json'});
			    	saveAs(b, "rooms.json");
		    		


			    });
			});
		</script>

<body>

    <section id="selector">
        <label for="files">Select a file: </label>
        <input id="files" type="file" />
        <br />
    </section>

    <section id="roomList">
    	<div></div>
    	<button>Add Room</button>
    </section>


    <section id="editor">
		<form id="roomMaker" action="/">
				<label for="required">Required</label>
			<fieldset id="required">
				<label for="name">Room Name</label>
				<input type="text" name="name"></input>
			</fieldset>
			<label for="name">Test Field</label>
			<input type="text" name="test"></input>
			<input type="submit" id="save" value="Save Room" />
		</form>

	<div id="results"></div>
</body>