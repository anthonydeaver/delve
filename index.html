<html>
	<head>
		<title>Delve</title>
		<script src="http://code.jquery.com/jquery-2.1.0.min.js" type="text/javascript"></script>
		<script src="js/app/delve.js" type="text/javascript"></script>
		<script src="js/app/player.js" type="text/javascript"></script>
		<script src="js/app/DelveMap.js" type="text/javascript"></script>
		<script src="js/app/Parser.js" type="text/javascript"></script>
		<script src="js/app/Modal.js" type="text/javascript"></script>
		<script src="js/app/Rooms.js" type="text/javascript"></script>
		<script src="js/app/utils.js" type="text/javascript"></script>
		<script src="js/app/Eventer.js" type="text/javascript"></script>
		<style>
			body {
				overflow: hidden;
				padding:20px;
			}
			section { padding: 10px; }
			#display header { 
				font-size: 24px; 
				font-weight: bolder; 
				border-bottom: 1px solid gray; 
				margin-bottom: 10px;
			}
			#display article#desc {
				/*min-height: 280px;*/
			}
			/*#nav { width: 400px; }*/
			#command input{
				width: 380px;
				border: none;
				background-color: white;
				color: black;
				padding: 5px;
				text-transform: uppercase;
			}
			#console {
				resize: none;
				width: 380px;
				height: 30px;
				border:none;
			}
/*			#nav table { width: 300px; margin: 0 auto; }
			#nav button { width: 100px; }
			#nav button.disabled{ opacity: 0.4; }
*/			#left, #map, #nav, #nav header, #feedback, #command { 
				float: left; 
				background: rgba(255,255,255,0.3);
				border-radius: 10px;
				color: white;
				border: 2px solid rgba(255,255,255,0.8);  
				height: auto; 
				position: relative;
			}
			#command {
				width: 400px;
				height:50px;
				clear: both;
				margin-top: 25px;
			}
			section#left { 
				width: 400px; 
				background: rgba(255,255,255,0.3);
				border-radius: 10px;
				color: white;
				height: auto;
				margin-right: 10px;
			}
			section#map { width: 500px; overflow:auto; padding: 0px; height: 502px; display: none;}
			#map header {
				background-color: rgba(255,255,255,0.2);
				color: white;
				font-weight: bold;
				padding: 5;
			}
			#map span {
				display: block;
				border: 1px solid white;
				width: 100px;
				text-align: center;
				position: absolute;
				height: 20px;
			}

			#nav {
				right: -325px;
				position: absolute;
				min-height: 200px;
				width: 300px;
			}
			#nav header {
				height: 15px;
				padding: 10px;
				-webkit-transform: rotate(-90deg);
				border-radius: 10px 10px 0px 0px;
				left: -69px;
				top:20px;
			}

/*			.modal {
				width: 300px;
				height: auto;
				border: 1px solid black;
				position: absolute;
				top: 100px;
				left: 269px;
				background-color: white;
				padding: 10px;
			}

*/
			#modal #message {
				height: 210px;
				overflow: auto;
			}
			.eventPanel {
				background: none repeat scroll 0 0 white;
				border: 2px solid transparent;
				left: 250px;
				padding: 5px;
				position: absolute;
				top: 90px;
				width: 335px;
				z-index: 20;
			}
			.eventPanel:before {
				background-color: white;
				opacity: 0.6;
				content: " ";
				height: 5000px;
				left: -252px;
				position: absolute;
				top: -100px;
				width: 5000px;
				z-index: -2;
			}

			.eventPanel:after {
				position: absolute;
				top: -2px;
				left: -2px;
				width: 100%;
				height: 100%;
				content: " ";
				border: 2px solid black;
				box-shadow: 5px 5px 5px #666666;
				z-index: -2;
			}

			.button {
				border: 1px solid black;
				width: 100px;
				height: 20px;
				text-align: center;
				cursor: pointer;
			}

			#feedback {
				height: 80%;
				width: 80%;
				color: white;
				position: absolute;
				z-index:10000;
				background-color: black;
				color: green;
				display: none;
			}
		</style>
	</head>
	<body>
		<section id="left" class="draggable">
			<section id="display">
				<header></header>
				<article id="desc"></article>
				<article id="exits">
					Exits are:
					<ul>
					</ul>
				</article>
			</section>
			<section id="nav2">
				<div id="console" ></div>
				 <!-- type commands here<br /> -->
				<!-- <table>
					<tr>
						<td colspan=2 align="center">
							<button class="disabled" data-dir="north">North</button>
						</td>
					</tr>
					<tr>
						<td align="center">
							<button class="disabled" data-dir="west">West</button>
						</td>
						<td align="center">
							<button class="disabled" data-dir="east">East</button>
						</td>
					</tr>
					<tr>
						<td colspan=2 align="center">
							<button class="disabled" data-dir="south">South</button>
						</td>
					</tr>
				</table> -->
			</section>
		</section>
		<section id="command">
		Enter Command:
			<input id="" type="text" value="> _"/>
		</section>			
		<section id="map" class="draggable">
		<!-- 25 'rows' high -->
		<!-- ~20 pixels per 'row' -->
			<header>Map</header>
		</section>
		<section id="nav">
			<header>controls</header>
				<button id="temp" data-dir="south">Help</button>
				<button id="temp" data-dir="south">Help</button>
				<div id="BTN_MAP_TOGGLE" class="button">Open Map</div>
		</section>
		<textarea id="feedback">
		</textarea>
	</body>
		<script>
			var urlParams;
			var crunch = function () {
			    var match,
			        pl     = /\+/g,  // Regex for replacing addition symbol with a space
			        search = /([^&=]+)=?([^&]*)/g,
			        decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
			        query  = window.location.search.substring(1);

			    urlParams = {};
			    while (match = search.exec(query))
			       urlParams[decode(match[1])] = decode(match[2]);
			    
			};
			crunch();
			var $event = new Eventer();
			var $delve = new Engine(urlParams);
		</script>
		<script>
		(function($) {
    $.fn.drags = function(opt) {

        opt = $.extend({handle:"",cursor:"move"}, opt);

        if(opt.handle === "") {
            var $el = this;
        } else {
            var $el = this.find(opt.handle);
        }

        return $el.css('cursor', opt.cursor).on("mousedown", function(e) {
            if(opt.handle === "") {
                var $drag = $(this).addClass('draggable');
            } else {
                var $drag = $(this).addClass('active-handle').parent().addClass('draggable');
            }
            var z_idx = $drag.css('z-index'),
                drg_h = $drag.outerHeight(),
                drg_w = $drag.outerWidth(),
                pos_y = $drag.offset().top + drg_h - e.pageY,
                pos_x = $drag.offset().left + drg_w - e.pageX;
            $drag.css('z-index', 1000).parents().on("mousemove", function(e) {
                $('.draggable').offset({
                    top:e.pageY + pos_y - drg_h,
                    left:e.pageX + pos_x - drg_w
                }).on("mouseup", function() {
                    $(this).removeClass('draggable').css('z-index', z_idx);
                });
            });
            e.preventDefault(); // disable selection
        }).on("mouseup", function() {
            if(opt.handle === "") {
                $(this).removeClass('draggable');
            } else {
                $(this).removeClass('active-handle').parent().removeClass('draggable');
            }
        });

    }
})(jQuery);

// $('section.draggable').drags();
		</script>
	</html>